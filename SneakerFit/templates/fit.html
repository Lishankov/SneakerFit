<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Подбор — SneakerFit</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="topbar">
    <div class="logo">SneakerFit</div>

    <div class="center-menu">
        <a href="/how"><button class="ghost-btn">Как это работает</button></a>
        <a href="/fit"><button class="ghost-btn">Подбор</button></a>
        <a href="/about"><button class="ghost-btn">О нас</button></a>
    </div>

    <div class="right-menu">
        <a href="/measure"><button class="nav-btn">Измерить стопу</button></a>
        <a href="/profile"><button class="nav-btn">Профиль</button></a>
    </div>
</div>

<div class="main-content">
    <div class="container">
        <div class="card" style="animation: fadeIn 0.4s">
            <h1 style="text-align:center">Подбор обуви</h1>
            <p style="text-align:center; margin-bottom: 20px; color: #666;">
                На основе ваших измерений стопы
            </p>

            <div id="recommendations-container">
                <div style="text-align: center; padding: 40px;">
                    <div class="spinner" style="width: 40px; height: 40px; margin: 0 auto;"></div>
                    <p style="margin-top: 20px;">Загружаем рекомендации...</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
async function loadRecommendations() {
    try {
        const response = await fetch('/get_recommendations');
        const recommendations = await response.json();

        const container = document.getElementById('recommendations-container');

        if (recommendations.error) {
            container.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <p>Пожалуйста, войдите в систему</p>
                    <a href="/loggin" class="btn btn-primary">Войти</a>
                </div>
            `;
            return;
        }

        if (recommendations.length === 0) {
            container.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <p>Для получения рекомендаций необходимо заполнить измерения стопы</p>
                    <a href="/measure" class="btn btn-primary">Заполнить измерения</a>
                </div>
            `;
            return;
        }

        let html = '<div style="display: flex; flex-wrap: wrap; gap: 30px; justify-content: center;">';

        recommendations.forEach(rec => {
            let imageUrl = "https://via.placeholder.com/175x150/4285f4/ffffff?text=" + encodeURIComponent(rec.model.split(' ')[0]);

            html += `
                <div style="text-align: center; margin: 0 20px;">
                    <img src="${imageUrl}" width="175" height="150" style="border-radius: 8px;">
                    <h3 style="font-weight: bolder; margin: 10px 0 7px">${rec.model}</h3>
                    <div style="margin: 5px 0;">
                        <strong>Совместимость: ${rec.compatibility}%</strong>
                    </div>
                    <div style="margin: 5px 0; font-size: 14px; color: #666;">
                        Рекомендуемый размер: EU ${rec.best_size.eu}
                    </div>
                    <a href="/shoe/${encodeURIComponent(rec.model)}" style="margin: 5px">
                        <button class="nav-btn">Подробнее</button>
                    </a>
                </div>
            `;
        });

        html += '</div>';
        container.innerHTML = html;

    } catch (error) {
        console.error('Error loading recommendations:', error);
        document.getElementById('recommendations-container').innerHTML = `
            <div style="text-align: center; padding: 40px;">
                <p>Ошибка загрузки рекомендаций</p>
            </div>
        `;
    }
}

document.addEventListener('DOMContentLoaded', loadRecommendations);
</script>

<footer class="global-footer">by SneakerFit team © 2025</footer>
</body>
</html>